# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.
---
loader: taskgraph.loader.transform:loader

transforms:
    - focus_android_taskgraph.transforms.build:transforms
    - taskgraph.transforms.job:transforms
    - taskgraph.transforms.task:transforms

kind-dependencies:
    - toolchain

job-defaults:
    fetches:
        toolchain:
            - android-sdk-linux
            - android-gradle-dependencies
    run:
        using: gradlew
        use-caches: false
        workdir: '/builds/worker'
    run-on-tasks-for: []
    treeherder:
        kind: build
        symbol: B
        platform: android-all/opt
        tier: 1
    worker-type: b-android
    worker:
        docker-image: {in-tree: base}
        max-run-time: 7200
        chain-of-trust: true

jobs:
    focus-debug:
        description: 'Build Focus for Android from source code'
        run-on-tasks-for: [github-pull-request, github-push]
        run:
            gradle-build-type: debug
            gradle-build-name: focusDebug
        treeherder:
            symbol: debug(Bf)

    klar-debug:
        description: 'Build Klar for Android from source code'
        run-on-tasks-for: [github-pull-request, github-push]
        run:
            gradle-build-type: debug
            gradle-build-name: klarDebug
        treeherder:
            symbol: debug(Bkl)

    focus-release:
        description: 'Release build for Focus for Android'
        include-shippable-secrets: true
        # attributes:
        #     release-type: release
        # include-release-version: true
        # filter-incomplete-translations: true
        run:
            gradle-build-type: release
            gradle-build-name: focusRelease
        treeherder:
            symbol: release(Bf)

    klar-release:
        description: 'Release build for Klar for Android'
        include-shippable-secrets: true
        # attributes:
            # release-type: release
        # include-release-version: true
        # filter-incomplete-translations: true
        run:
            gradle-build-type: release
            gradle-build-name: klarRelease
        treeherder:
            symbol: release(Bkl)

    # nightly:
    #     attributes:
    #         nightly: true
    #     include-nightly-version: true
    #     include-shippable-secrets: true
    #     run:
    #         gradle-build-type: nightly
    #     run-on-tasks-for: []
    #     treeherder:
    #         symbol: nightly(B)

    # beta:
    #     attributes:
    #         release-type: beta
    #     include-release-version: true
    #     include-shippable-secrets: true
    #     filter-incomplete-translations: true
    #     run:
    #         gradle-build-type: beta
    #     treeherder:
    #         symbol: beta(B)
